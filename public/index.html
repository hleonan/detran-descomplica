<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Despachante Virtual.RJ - Servi√ßos DETRAN Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #001f3f 0%, #003D7A 50%, #005FA3 100%);
            min-height: 100vh;
            color: #333;
        }

        /* HEADER */
        header {
            background: rgba(0, 29, 61, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 20px rgba(0, 212, 255, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 2px solid rgba(0, 212, 255, 0.3);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-img {
            width: 50px;
            height: 50px;
            filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.5));
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 1px;
            background: linear-gradient(90deg, #ffffff 0%, #00D4FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-subtitle {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .btn-professional {
            background: linear-gradient(135deg, #00D4FF 0%, #0099CC 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-professional:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 212, 255, 0.5);
        }

        /* CONTAINER */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 50px 30px;
        }

        /* SCREENS */
        .screen {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* TELA 1: INICIAL */
        .hero-section {
            text-align: center;
            margin-bottom: 60px;
        }

        .hero-title {
            font-size: 48px;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
            line-height: 1.2;
        }

        .hero-subtitle {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 50px;
            line-height: 1.6;
        }

        .main-choices {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .choice-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .choice-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #003D7A 0%, #00D4FF 100%);
        }

        .choice-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0, 212, 255, 0.3);
            border-color: #00D4FF;
        }

        .choice-icon {
            font-size: 80px;
            margin-bottom: 25px;
            filter: drop-shadow(0 5px 15px rgba(0, 61, 122, 0.3));
        }

        .choice-title {
            font-size: 28px;
            color: #003D7A;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .choice-description {
            font-size: 16px;
            color: #666;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .btn-choice {
            background: linear-gradient(135deg, #003D7A 0%, #005FA3 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-choice:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 61, 122, 0.4);
        }

        /* TELA 2: ENTRADA DE DADOS */
        .data-entry-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 800px;
            margin: 0 auto;
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 32px;
            color: #003D7A;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .section-subtitle {
            font-size: 16px;
            color: #666;
            line-height: 1.6;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            color: #003D7A;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus {
            outline: none;
            border-color: #00D4FF;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
        }

        .divider {
            text-align: center;
            margin: 35px 0;
            color: #999;
            font-weight: 600;
            position: relative;
        }

        .divider::before,
        .divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: #e0e0e0;
        }

        .divider::before {
            left: 0;
        }

        .divider::after {
            right: 0;
        }

        .upload-area {
            border: 3px dashed #00D4FF;
            border-radius: 15px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.05) 0%, rgba(0, 61, 122, 0.05) 100%);
        }

        .upload-area:hover {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(0, 61, 122, 0.1) 100%);
            border-color: #003D7A;
        }

        .upload-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 16px;
            color: #003D7A;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 13px;
            color: #999;
        }

        .btn-primary {
            background: linear-gradient(135deg, #003D7A 0%, #005FA3 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 61, 122, 0.4);
        }

        .btn-back {
            background: #6C757D;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .btn-back:hover {
            background: #5A6268;
        }

        /* TELA 3: ALERTA */
        .alert-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
        }

        .alert-icon {
            font-size: 100px;
            margin-bottom: 30px;
            filter: drop-shadow(0 5px 20px rgba(255, 193, 7, 0.5));
        }

        .alert-title {
            font-size: 36px;
            color: #856404;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .alert-message {
            font-size: 18px;
            color: #666;
            line-height: 1.8;
            margin-bottom: 40px;
        }

        /* TELA 4: OP√á√ïES DE SERVI√áOS */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .service-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 35px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-top: 4px solid #003D7A;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 212, 255, 0.3);
        }

        .service-icon {
            font-size: 50px;
            margin-bottom: 20px;
        }

        .service-title {
            font-size: 20px;
            color: #003D7A;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .service-description {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .btn-service {
            background: #003D7A;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .btn-service:hover {
            background: #005FA3;
        }

        /* TELA 6: LISTA DE MULTAS */
        .multas-resumo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .resumo-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 5px solid #00D4FF;
        }

        .resumo-icon {
            font-size: 40px;
        }

        .resumo-content {
            flex: 1;
        }

        .resumo-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }

        .resumo-value {
            font-size: 28px;
            color: #003D7A;
            font-weight: 700;
        }

        .multas-lista {
            display: grid;
            gap: 20px;
        }

        .multa-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #FF6B6B;
            transition: all 0.3s ease;
        }

        .multa-card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }

        .multa-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .multa-data {
            font-size: 14px;
            color: #666;
            font-weight: 600;
        }

        .multa-status {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pendente {
            background: #FFF3CD;
            color: #856404;
        }

        .status-pago {
            background: #D4EDDA;
            color: #155724;
        }

        .multa-descricao {
            font-size: 16px;
            color: #003D7A;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .multa-detalhes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .multa-detalhe {
            display: flex;
            flex-direction: column;
        }

        .detalhe-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .detalhe-value {
            font-size: 16px;
            color: #003D7A;
            font-weight: 600;
        }

        .multa-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-recorrer {
            background: linear-gradient(135deg, #00D4FF 0%, #0099CC 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
        }

        .btn-recorrer:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
        }

        .btn-pagar {
            background: #28A745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
        }

        .btn-pagar:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .loading-spinner {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #003D7A;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-spinner p {
            color: #666;
            font-size: 16px;
        }

        .multas-empty {
            text-align: center;
            padding: 60px 20px;
        }

        .multas-empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .multas-empty-title {
            font-size: 24px;
            color: #003D7A;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .multas-empty-text {
            font-size: 16px;
            color: #666;
        }

        /* TELA 5: OUTROS SERVI√áOS */
        .other-services-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .service-category {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #00D4FF;
        }

        .category-title {
            font-size: 24px;
            color: #003D7A;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .service-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .service-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid #003D7A;
        }

        .service-item:hover {
            background: #e8f0ff;
            transform: translateX(5px);
        }

        .service-item-title {
            font-size: 15px;
            color: #003D7A;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .service-item-desc {
            font-size: 13px;
            color: #666;
        }

        /* RESPONSIVIDADE */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 32px;
            }

            .hero-subtitle {
                font-size: 16px;
            }

            .main-choices {
                grid-template-columns: 1fr;
            }

            .data-entry-section,
            .alert-section,
            .other-services-section {
                padding: 30px 20px;
            }

            .services-grid {
                grid-template-columns: 1fr;
            }

            .logo-title {
                font-size: 18px;
            }

            .btn-professional {
                padding: 10px 15px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header>
        <div class="header-container">
            <div class="logo-container">
                <img src="/assets/logo.png" alt="Despachante Virtual.RJ" class="logo-img">
                <div class="logo-text">
                    <div class="logo-title">DESPACHANTE VIRTUAL.RJ</div>
                    <div class="logo-subtitle">Servi√ßos DETRAN Online</div>
                </div>
            </div>
            <button class="btn-professional" onclick="showProfessionalLogin()">
                üë®‚Äç‚öñÔ∏è Sou Profissional
            </button>
        </div>
    </header>

    <!-- CONTAINER -->
    <div class="container">
        <!-- TELA 1: INICIAL -->
        <div id="screen1" class="screen active">
            <div class="hero-section">
                <h1 class="hero-title">MOTORISTA, ANALISE A SITUA√á√ÉO DA SUA CNH</h1>
                <p class="hero-subtitle">Verifique multas, pontua√ß√£o e risco de suspens√£o em segundos</p>
            </div>

            <div class="main-choices">
                <!-- OP√á√ÉO 1: ANALISAR CNH -->
                <div class="choice-card" onclick="goToScreen2()">
                    <div class="choice-icon">üéØ</div>
                    <h2 class="choice-title">Analisar Minha CNH</h2>
                    <p class="choice-description">
                        Consulte sua situa√ß√£o completa no DETRAN:<br>
                        ‚úì Certid√£o Nada Consta<br>
                        ‚úì Multas e Pontua√ß√£o<br>
                        ‚úì Processos de Suspens√£o<br>
                        ‚úì Op√ß√£o de Recurso
                    </p>
                    <button class="btn-choice">Come√ßar An√°lise</button>
                </div>

                <!-- OP√á√ÉO 2: OUTROS SERVI√áOS -->
                <div class="choice-card" onclick="goToScreen5()">
                    <div class="choice-icon">üìã</div>
                    <h2 class="choice-title">Outros Servi√ßos</h2>
                    <p class="choice-description">
                        Acesse servi√ßos complementares:<br>
                        ‚úì Consulta de Ve√≠culos<br>
                        ‚úì Pagamento de Tributos<br>
                        ‚úì Agendamentos<br>
                        ‚úì Licenciamento
                    </p>
                    <button class="btn-choice">Ver Servi√ßos</button>
                </div>
            </div>
        </div>

        <!-- TELA 2: ENTRADA DE DADOS -->
        <div id="screen2" class="screen">
            <button class="btn-back" onclick="goToScreen1()">‚Üê Voltar</button>
            
            <div class="data-entry-section">
                <div class="section-header">
                    <h2 class="section-title">Insira seus Dados</h2>
                    <p class="section-subtitle">Precisamos do seu CPF e n√∫mero da CNH para consultar sua situa√ß√£o</p>
                </div>

                <form onsubmit="handleDataEntry(event)">
                    <div class="form-group">
                        <label for="cpf">CPF *</label>
                        <input 
                            type="text" 
                            id="cpf" 
                            placeholder="000.000.000-00" 
                            maxlength="14"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="cnh">N√∫mero da CNH *</label>
                        <input 
                            type="text" 
                            id="cnh" 
                            placeholder="00000000000" 
                            maxlength="11"
                            required
                        >
                    </div>

                    <div class="divider">OU</div>

                    <div class="upload-area" onclick="document.getElementById('fileUpload').click()">
                        <div class="upload-icon">üì∏</div>
                        <p class="upload-text">Clique para fazer upload da CNH</p>
                        <p class="upload-hint">Extrairemos os dados automaticamente</p>
                    </div>
                    <input type="file" id="fileUpload" style="display: none;"
                      accept="application/pdf,image/jpeg,image/jpg,image/png">

                    <button type="submit" class="btn-primary">Continuar</button>
                </form>
            </div>
        </div>

        <!-- TELA 3: ALERTA -->
        <div id="screen3" class="screen">
            <button class="btn-back" onclick="goToScreen2()">‚Üê Voltar</button>
            
            <div class="alert-section">
                <div class="alert-icon">‚ö†Ô∏è</div>
                <h2 class="alert-title">Voc√™ Tem Poss√≠veis Problemas</h2>
                <p class="alert-message">
                    Identificamos ocorr√™ncias em seu prontu√°rio de CNH.<br>
                    Vamos analisar sua situa√ß√£o detalhadamente.
                </p>
                <button class="btn-primary" onclick="goToScreen4()">Prosseguir com An√°lise</button>
            </div>
        </div>

        <!-- TELA 4: OP√á√ïES DE SERVI√áOS CNH -->
        <div id="screen4" class="screen">
            <button class="btn-back" onclick="goToScreen3()">‚Üê Voltar</button>
            
            <div class="data-entry-section" style="max-width: 1200px;">
                <div class="section-header">
                    <h2 class="section-title">Escolha o Servi√ßo</h2>
                    <p class="section-subtitle">Selecione o que deseja fazer com sua CNH</p>
                </div>

                <div class="services-grid">
                    <!-- CERTID√ÉO -->
                    <div class="service-card" onclick="selectService('certidao')">
                        <div class="service-icon">üìÑ</div>
                        <h3 class="service-title">Emitir Certid√£o Nada Consta</h3>
                        <p class="service-description">Documento oficial do DETRAN comprovando sua situa√ß√£o</p>
                        <button class="btn-service" onclick="abrirCertidao()">Emitir Certid√£o</button>
                    </div>

                    <!-- MULTAS -->
                    <div class="service-card" onclick="goToScreen6()">
                        <div class="service-icon">üìã</div>
                        <h3 class="service-title">Consultar Multas</h3>
                        <p class="service-description">Veja todas as suas multas com detalhes completos</p>
                        <button class="btn-service" onclick="goToScreen6()">Ver Multas</button>
                    </div>

                    <!-- SUSPENS√ÉO -->
                    <div class="service-card" onclick="selectService('suspensao')">
                        <div class="service-icon">‚öñÔ∏è</div>
                        <h3 class="service-title">Processo de Suspens√£o</h3>
                        <p class="service-description">Acompanhe processos de suspens√£o ou cassa√ß√£o</p>
                        <button class="btn-service">Consultar Processo</button>
                    </div>

                    <!-- RECURSO -->
                    <div class="service-card" onclick="selectService('recurso')">
                        <div class="service-icon">‚öñÔ∏è</div>
                        <h3 class="service-title">Defesa/Recurso</h3>
                        <p class="service-description">Protocole recurso de multas automaticamente</p>
                        <button class="btn-service">Protocolar Recurso</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TELA 6: LISTA DE MULTAS -->
        <div id="screen6" class="screen">
            <button class="btn-back" onclick="goToScreen4()">‚Üê Voltar</button>
            
            <div class="data-entry-section" style="max-width: 1200px;">
                <div class="section-header">
                    <h2 class="section-title">Suas Multas de Tr√¢nsito</h2>
                    <p class="section-subtitle" id="multas-subtitle">Carregando...</p>
                </div>

                <!-- RESUMO -->
                <div id="multas-resumo" class="multas-resumo" style="display: none;">
                    <div class="resumo-card">
                        <div class="resumo-icon">üìä</div>
                        <div class="resumo-content">
                            <div class="resumo-label">Pontos Totais</div>
                            <div class="resumo-value" id="pontos-totais">0</div>
                        </div>
                    </div>
                    <div class="resumo-card">
                        <div class="resumo-icon">üö®</div>
                        <div class="resumo-content">
                            <div class="resumo-label">Multas Pendentes</div>
                            <div class="resumo-value" id="multas-pendentes">0</div>
                        </div>
                    </div>
                    <div class="resumo-card">
                        <div class="resumo-icon">üõ°Ô∏è</div>
                        <div class="resumo-content">
                            <div class="resumo-label">Situa√ß√£o</div>
                            <div class="resumo-value" id="situacao-cnh">Regular</div>
                        </div>
                    </div>
                </div>

                <!-- LISTA DE MULTAS -->
                <div id="multas-lista" class="multas-lista">
                    <!-- Multas ser√£o inseridas aqui via JavaScript -->
                </div>

                <!-- LOADING -->
                <div id="multas-loading" class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Consultando multas no DETRAN-RJ...</p>
                </div>
            </div>
        </div>

        <!-- TELA 5: OUTROS SERVI√áOS -->
        <div id="screen5" class="screen">
            <button class="btn-back" onclick="goToScreen1()">‚Üê Voltar</button>
            
            <div class="other-services-section">
                <div class="section-header">
                    <h2 class="section-title">Outros Servi√ßos DETRAN</h2>
                    <p class="section-subtitle">Servi√ßos complementares para ve√≠culos, agendamentos e pagamentos</p>
                </div>

                <!-- VE√çCULOS -->
                <div class="service-category">
                    <h3 class="category-title">üöó Consulta de Ve√≠culos</h3>
                    <div class="service-list">
                        <div class="service-item" onclick="selectOtherService('veiculo-info')">
                            <div class="service-item-title">Informa√ß√µes do Ve√≠culo</div>
                            <div class="service-item-desc">Consulte dados completos do ve√≠culo</div>
                        </div>
                        <div class="service-item" onclick="selectOtherService('debitos')">
                            <div class="service-item-title">Consulta de D√©bitos</div>
                            <div class="service-item-desc">Multas, IPVA e GRT</div>
                        </div>
                    </div>
                </div>

                <!-- AGENDAMENTOS -->
                <div class="service-category">
                    <h3 class="category-title">üìÖ Agendamentos</h3>
                    <div class="service-list">
                        <div class="service-item" onclick="selectOtherService('agendar-cnh')">
                            <div class="service-item-title">Renova√ß√£o de CNH</div>
                            <div class="service-item-desc">Agende renova√ß√£o ou 2¬™ via</div>
                        </div>
                        <div class="service-item" onclick="selectOtherService('agendar-identidade')">
                            <div class="service-item-title">Identidade (RG)</div>
                            <div class="service-item-desc">1¬™ via, renova√ß√£o ou 2¬™ via</div>
                        </div>
                        <div class="service-item" onclick="selectOtherService('agendar-veiculo')">
                            <div class="service-item-title">Servi√ßos Veiculares</div>
                            <div class="service-item-desc">Inspe√ß√£o, transfer√™ncia, etc.</div>
                        </div>
                    </div>
                </div>

                <!-- PAGAMENTOS -->
                <div class="service-category">
                    <h3 class="category-title">üí≥ Pagamento de Tributos</h3>
                    <div class="service-list">
                        <div class="service-item" onclick="selectOtherService('pagar-ipva')">
                            <div class="service-item-title">IPVA</div>
                            <div class="service-item-desc">Emitir boleto IPVA</div>
                        </div>
                        <div class="service-item" onclick="selectOtherService('pagar-duda')">
                            <div class="service-item-title">DUDA</div>
                            <div class="service-item-desc">Documento de arrecada√ß√£o</div>
                        </div>
                        <div class="service-item" onclick="selectOtherService('pagar-grt')">
                            <div class="service-item-title">GRT</div>
                            <div class="service-item-desc">Gerenciamento de Risco</div>
                        </div>
                        <div class="service-item" onclick="selectOtherService('pagar-multa')">
                            <div class="service-item-title">Multas</div>
                            <div class="service-item-desc">Emitir boleto de multas</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // NAVEGA√á√ÉO ENTRE TELAS
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function goToScreen1() {
            showScreen('screen1');
        }

        function goToScreen2() {
            showScreen('screen2');
        }

        function goToScreen3() {
            showScreen('screen3');
        }

        function goToScreen4() {
            showScreen('screen4');
        }

        function goToScreen5() {
            showScreen('screen5');
        }

        function goToScreen6() {
            showScreen('screen6');
            consultarMultas(); // Inicia consulta automaticamente
        }

        // CONSULTAR MULTAS
        async function consultarMultas() {
            const cpf = localStorage.getItem('USER_CPF');
            const cnh = localStorage.getItem('USER_CNH');

            if (!cpf || !cnh) {
                alert('Dados n√£o encontrados. Por favor, fa√ßa a consulta novamente.');
                goToScreen2();
                return;
            }

            // Mostrar loading
            document.getElementById('multas-loading').style.display = 'block';
            document.getElementById('multas-resumo').style.display = 'none';
            document.getElementById('multas-lista').innerHTML = '';

            try {
                const resp = await fetch('/api/consultar-multas', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cpf, cnh })
                });

                const data = await resp.json();

                if (!resp.ok || !data.ok) {
                    throw new Error(data.error || 'Erro ao consultar multas');
                }

                // Esconder loading
                document.getElementById('multas-loading').style.display = 'none';

                // Exibir resumo
                document.getElementById('pontos-totais').textContent = data.resumo.pontosTotais || '0';
                document.getElementById('multas-pendentes').textContent = data.resumo.multasPendentes || '0';
                document.getElementById('situacao-cnh').textContent = data.resumo.situacao || 'Regular';
                document.getElementById('multas-resumo').style.display = 'grid';

                // Atualizar subtitle
                const totalMultas = data.multas.length;
                document.getElementById('multas-subtitle').textContent = 
                    totalMultas > 0 
                        ? `Encontramos ${totalMultas} multa(s) registrada(s) em seu nome`
                        : 'Nenhuma multa encontrada';

                // Exibir multas
                if (totalMultas === 0) {
                    document.getElementById('multas-lista').innerHTML = `
                        <div class="multas-empty">
                            <div class="multas-empty-icon">‚úÖ</div>
                            <h3 class="multas-empty-title">Parab√©ns!</h3>
                            <p class="multas-empty-text">Voc√™ n√£o possui multas pendentes.</p>
                        </div>
                    `;
                } else {
                    const multasHTML = data.multas.map((multa, index) => `
                        <div class="multa-card">
                            <div class="multa-header">
                                <div class="multa-data">üìÖ ${multa.data || 'Data n√£o informada'}</div>
                                <div class="multa-status ${multa.status === 'Pago' ? 'status-pago' : 'status-pendente'}">
                                    ${multa.status || 'Pendente'}
                                </div>
                            </div>
                            <div class="multa-descricao">${multa.descricao || 'Descri√ß√£o n√£o dispon√≠vel'}</div>
                            <div class="multa-detalhes">
                                <div class="multa-detalhe">
                                    <div class="detalhe-label">Pontos</div>
                                    <div class="detalhe-value">${multa.pontos || '0'}</div>
                                </div>
                                <div class="multa-detalhe">
                                    <div class="detalhe-label">Valor</div>
                                    <div class="detalhe-value">${multa.valor || 'R$ 0,00'}</div>
                                </div>
                            </div>
                            <div class="multa-actions">
                                <button class="btn-recorrer" onclick="recorrerMulta(${index})">
                                    ‚öñÔ∏è Recorrer desta Multa
                                </button>
                                <button class="btn-pagar" onclick="pagarMulta(${index})">
                                    üí≥ Pagar Multa
                                </button>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('multas-lista').innerHTML = multasHTML;
                }

                // Guardar multas no localStorage para uso posterior
                localStorage.setItem('MULTAS_DATA', JSON.stringify(data.multas));

            } catch (err) {
                console.error('Erro ao consultar multas:', err);
                document.getElementById('multas-loading').style.display = 'none';
                document.getElementById('multas-lista').innerHTML = `
                    <div class="multas-empty">
                        <div class="multas-empty-icon">‚ö†Ô∏è</div>
                        <h3 class="multas-empty-title">Erro ao Consultar</h3>
                        <p class="multas-empty-text">${err.message || 'Tente novamente mais tarde.'}</p>
                    </div>
                `;
            }
        }

        // RECORRER MULTA
        function recorrerMulta(index) {
            const multas = JSON.parse(localStorage.getItem('MULTAS_DATA') || '[]');
            const multa = multas[index];
            
            if (!multa) {
                alert('Multa n√£o encontrada.');
                return;
            }

            // TODO: Implementar tela de recurso
            alert(`Recurso de multa em desenvolvimento!\n\nMulta: ${multa.descricao}\nValor: ${multa.valor}`);
        }

        // PAGAR MULTA
        function pagarMulta(index) {
            const multas = JSON.parse(localStorage.getItem('MULTAS_DATA') || '[]');
            const multa = multas[index];
            
            if (!multa) {
                alert('Multa n√£o encontrada.');
                return;
            }

            // TODO: Implementar pagamento
            alert(`Pagamento de multa em desenvolvimento!\n\nMulta: ${multa.descricao}\nValor: ${multa.valor}`);
        }

        // FORMATA√á√ÉO DE CPF
        document.getElementById('cpf')?.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            e.target.value = value;
        });

        // VALIDA√á√ÉO DE CPF
        function validarCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            if (cpf.length !== 11) return false;
            
            // Valida√ß√£o b√°sica
            if (/^(\d)\1{10}$/.test(cpf)) return false;
            
            let soma = 0;
            let resto;
            
            for (let i = 1; i <= 9; i++) {
                soma += parseInt(cpf.substring(i-1, i)) * (11 - i);
            }
            
            resto = (soma * 10) % 11;
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpf.substring(9, 10))) return false;
            
            soma = 0;
            for (let i = 1; i <= 10; i++) {
                soma += parseInt(cpf.substring(i-1, i)) * (12 - i);
            }
            
            resto = (soma * 10) % 11;
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpf.substring(10, 11))) return false;
            
            return true;
        }

        // ENTRADA DE DADOS (AGORA CHAMA A API REAL)
  async
  // ENTRADA DE DADOS (TELA 2) -> chama o backend real
  async function handleDataEntry(event) {
    event.preventDefault();

    const cpf = document.getElementById("cpf").value;
    const cnh = document.getElementById("cnh").value;

    if (!validarCPF(cpf)) {
      alert("CPF inv√°lido! Por favor, verifique.");
      return;
    }

    const cpfDigits = cpf.replace(/\D/g, "");
    const cnhDigits = cnh.replace(/\D/g, "");

    // feedback simples
    alert("Consultando no DETRAN... pode demorar 20 a 60 segundos.");

    try {
      const resp = await fetch("/api/consultar-certidao", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ cpf: cpfDigits, cnh: cnhDigits }),
      });

      const data = await resp.json().catch(() => ({}));

      if (!resp.ok || !data.ok) {
        alert("Erro: " + (data.error || "Falha ao consultar"));
        return;
      }

      // guarda o caseId (pra Tela 4 emitir o PDF depois)
      localStorage.setItem("CASE_ID_CERTIDAO", data.caseId);
      
      // guarda CPF e CNH para consulta de multas
      localStorage.setItem("USER_CPF", cpfDigits);
      localStorage.setItem("USER_CNH", cnhDigits);

      // decide Tela 3 ou Tela 4
      if (data.temProblemas) {
        goToScreen3(); // ALERTA
      } else {
        goToScreen4(); // pula direto pro menu de servi√ßos
      }
    } catch (e) {
      alert("Erro: " + (e.message || e));
    }
  }

  // TELA 4 -> abrir PDF guardado
  function abrirCertidao() {
    const caseId = localStorage.getItem("CASE_ID_CERTIDAO");
    if (!caseId) {
      alert("N√£o encontrei uma certid√£o guardada. Fa√ßa a consulta primeiro (Tela 2).");
      return;
    }
    window.open(`/api/certidao/${caseId}`, "_blank");
  }

    // UPLOAD DE ARQUIVO (OCR)
    document.getElementById('fileUpload')?.addEventListener('change', async function (e) {
      const file = e.target.files?.[0];
      if (!file) return;

      // Feedback simples
      alert(`Arquivo selecionado: ${file.name}\n\nEnviando para OCR...`);

      try {
        const formData = new FormData();
        formData.append("doc", file); // tem que bater com o backend: upload.single("doc")

        const resp = await fetch("/api/ocr-cnh", {
          method: "POST",
          body: formData
        });
    
        const data = await resp.json();

        if (!resp.ok) {
          alert(data?.error || "Falha no OCR.");
          return;
        }

        // Preencher campos da Tela 2
        if (data?.cpf) document.getElementById("cpf").value = data.cpf;
        if (data?.cnh) document.getElementById("cnh").value = data.cnh;
    
        alert("OCR conclu√≠do! Confira CPF e CNH e clique em Continuar.");
      } catch (err) {
        alert("Erro de rede ao chamar OCR.");
        console.error(err);
      }
    });

        // SELECIONAR SERVI√áO CNH
        function selectService(service) {
            // Se for certid√£o, abre o PDF guardado
            if (service === 'certidao') {
                abrirCertidao();
                return;
            }
            
            // Outros servi√ßos ainda em desenvolvimento
            const messages = {
                'multas': 'Consultando multas...\n\nFluxo em desenvolvimento.',
                'suspensao': 'Consultando processos de suspens√£o...\n\nFluxo em desenvolvimento.',
                'recurso': 'Preparando recurso de multa...\n\nFluxo em desenvolvimento.'
            };
            alert(messages[service]);
        }

        // SELECIONAR OUTRO SERVI√áO
        function selectOtherService(service) {
            alert(`Servi√ßo selecionado: ${service}\n\nFluxo em desenvolvimento.`);
        }

        // PROFISSIONAL
        function showProfessionalLogin() {
            alert('√Årea Profissional\n\nLogin/Cadastro em desenvolvimento.\n\nAqui advogados e despachantes poder√£o:\n- Gerenciar m√∫ltiplos clientes\n- Receber alertas autom√°ticos\n- Gerar relat√≥rios\n- Protocolar recursos em lote');
        }
    </script>
</body>
</html>
